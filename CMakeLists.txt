CMAKE_MINIMUM_REQUIRED(VERSION 2.8.4)
PROJECT(em400 C)

SET(WITH_DEBUGGER 1)

SET(EM400_VERSION 0.2.1)

FIND_PACKAGE(BISON)
FIND_PACKAGE(FLEX)
FIND_PACKAGE(Threads)

INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/include)
INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/src)

ADD_DEFINITIONS(-Wall -g -std=c99 -O3 -DEM400_VERSION="${EM400_VERSION}")

IF(WITH_DEBUGGER)
	SET(CURSES_NEED_NCURSES TRUE)
	FIND_PACKAGE(Curses)
	INCLUDE_DIRECTORIES(SYSTEM ${CURSES_INCLUDE_DIR})
	INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR}/debugger)

	FIND_PATH(READLINE_INCLUDE_DIR readline/readline.h)
	FIND_LIBRARY(READLINE_LIBRARY NAMES readline)
	INCLUDE_DIRECTORIES(${READLINE_INCLUDE_DIR})

	ADD_DEFINITIONS(-DWITH_DEBUGGER)
	SET(DEBUGGER_LIBS debugger ${CURSES_LIBRARIES} ${READLINE_LIBRARY})
ELSE(WITH_DEBUGGER)
	SET(DEBUGGER_LIBS)
ENDIF(WITH_DEBUGGER)

ADD_SUBDIRECTORY(src)

# vim: tabstop=4
